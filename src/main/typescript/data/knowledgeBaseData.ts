/**
 * INPUT: 無（靜態常數）
 * OUTPUT: 三層知識庫預萃取法規段落（KB1 央行 weight=3, KB2 政策 weight=2, KB3 一般 weight=1）
 * POS: 資料層，供 ragService 檢索使用
 *
 * 文件來源：
 *   KB1 — 中央銀行對金融機構辦理不動產抵押貸款業務規定問與答（114.9.8生效）
 *   KB2 — 個金政策性貸款規章輯要最新版 (114.12)
 *   KB3 — 個金授信規章輯要最新版1141231
 */

import { KbChunk } from '../models/rag';

// ══════════════════════════════════════════════════════════════
// KB1：央行不動產抵押貸款規定（priority = 3，最高權重）
// ══════════════════════════════════════════════════════════════

const KB1_CHUNKS: KbChunk[] = [
  {
    id: 'kb1-001',
    source: '央行規定',
    priority: 3,
    topic: '第1戶購屋貸款寬限期禁止',
    keywords: ['第1戶', '第一戶', '寬限期', '不得有寬限期', '名下有房屋', '113.9.20'],
    content: `【央行規定 Q1/Q2】第1戶購屋貸款（自然人名下已有房屋者）：
自113年9月20日起，凡借款人名下已持有房屋，再行申貸購屋貸款時，不得有寬限期。
此規定適用於全國所有地區，無地區差異。
名下「有無房屋」認定：以借款人（含配偶、未成年子女）名下持有房屋為準；
若名下無房屋，則屬首購，可依一般規定申請寬限期。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-002',
    source: '央行規定',
    priority: 3,
    topic: '第2戶購屋貸款成數上限',
    keywords: ['第2戶', '第二戶', '5成', '五成', '成數上限', '全國', '鑑價', '買賣金額'],
    content: `【央行規定 Q3/Q4】第2戶購屋貸款成數上限：
全國一律：成數上限為5成（以鑑價或買賣金額較低者為計算基礎）。
適用於：借款人名下已有1戶房屋，再行申購第2戶住宅。
無論地區（六都或非六都），第2戶上限均為5成。
注意：若貸款資金用途非為購屋，但實質流向購屋，亦受此限制。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-003',
    source: '央行規定',
    priority: 3,
    topic: '高價住宅第3戶公司法人成數上限',
    keywords: ['第3戶', '第三戶', '高價住宅', '公司法人', '3成', '三成', '成數上限', '餘屋', '豪宅'],
    content: `【央行規定 Q5】高價住宅、第3戶以上、公司法人、餘屋貸款成數上限：
以下情形貸款成數上限均為3成：
1. 高價住宅（各地區認定標準依央行公告）
2. 第3戶以上購屋貸款（名下已有2戶以上房屋）
3. 公司法人購置住宅
4. 餘屋貸款（建商或個人持有待售餘屋）
此3成上限同樣以鑑價或買賣金額較低者為計算基礎。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-004',
    source: '央行規定',
    priority: 3,
    topic: '繼承房屋不計入央行規定戶數',
    keywords: ['繼承', '繼承取得', '不計入', '房屋數', '貸款戶數', 'Q11', 'Q12', 'Q14'],
    content: `【央行規定 Q11/Q12/Q14】繼承房屋之特殊處理：
因繼承取得之房屋，不計入央行規定之房屋數及房貸戶數。
實例：借款人因繼承持有1戶房屋，再申購1戶，仍視為「第1戶」，適用首購規定（非第2戶限制）。
但繼承房屋之貸款本身，若屬新申貸，仍受現行規定拘束。
此豁免僅限合法繼承取得，贈與等其他方式取得不適用。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-005',
    source: '央行規定',
    priority: 3,
    topic: '換屋協處措施（主張換屋需求免受限制）',
    keywords: ['換屋', '換屋協處', '實質換屋', '切結', '免受限制', 'Q17', 'Q18', '換屋需求'],
    content: `【央行規定 Q17/Q18】換屋協處措施：
借款人若能主張「實質換屋需求」，向金融機構出具切結書承諾於一定期間內出售原有房屋，
則可不受寬限期禁止或成數上限之限制，改依換屋規定辦理。
切結內容：承諾於新屋撥款後1年內（或一定期限內）出售原有住宅。
適用時機：借款人已有1戶但確有換屋需要，不希望受第2戶5成成數限制者。
金融機構應於一定期限後追蹤確認出售情形。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-006',
    source: '央行規定',
    priority: 3,
    topic: '定存質借加計購屋貸款不得超過成數上限',
    keywords: ['定存質借', '合計', '不得超過', '成數上限', 'Q7', '定期存款'],
    content: `【央行規定 Q7】定存質借合計限制：
定期存款質借金額 + 購屋貸款金額，合計不得超過該房屋適用之貸款成數上限。
目的：防止借款人以定存質借方式規避購屋貸款成數限制。
例：第2戶成數上限5成，房屋價值1,000萬，則購屋貸款 + 定存質借合計不得超過500萬。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb1-007',
    source: '央行規定',
    priority: 3,
    topic: '他行貸款資金流向購屋亦受寬限期限制',
    keywords: ['他行貸款', '資金流向', '購置住宅', '寬限期限制', 'Q6', '其他擔保品', '名目申貸'],
    content: `【央行規定 Q6】資金流向認定：
若借款人以其他擔保品（如土地、廠房）或其他名目向金融機構申貸，
但資金實質流向購置住宅，亦受央行購屋貸款寬限期及成數限制。
金融機構應確實審核資金用途，防止規避。
違規情形：金融機構如核准不符規定之案件，將受央行處分。`,
    loanTypes: ['mortgage'],
  },
];

// ══════════════════════════════════════════════════════════════
// KB2：政策性貸款規章（priority = 2，中等權重）
// ══════════════════════════════════════════════════════════════

const KB2_CHUNKS: KbChunk[] = [
  {
    id: 'kb2-001',
    source: '政策性貸款',
    priority: 2,
    topic: '青安貸款申請資格',
    keywords: ['青安', '青年安心成家', '申請資格', '首購', '無自有住宅', '成年', '申貸一次', '112.8.1'],
    content: `【青安貸款申請資格】青年安心成家購屋優惠貸款（政府補貼）：
資格條件：
1. 年齡：申請人須年滿20歲
2. 住宅條件：申請人（含配偶）名下無自有住宅
3. 用途：限首次購置自住住宅
4. 申貸限制：僅限申貸一次，112年8月1日後已核貸者不得再次申請
5. 標的：購置住宅（含電梯大樓、公寓、透天厝等）
注意：112.8.1後核貸者即使已還清，亦不得再次申貸青安貸款。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb2-002',
    source: '政策性貸款',
    priority: 2,
    topic: '青安貸款額度與期限',
    keywords: ['青安', '最高額度', '1000萬', '最長期限', '40年', '寬限期', '5年'],
    content: `【青安貸款額度與期限】：
最高貸款額度：新台幣1,000萬元整
最長貸款期限：40年（含寬限期）
寬限期：最長5年（寬限期間只繳息不還本）
成數：依金融機構審核，最高不超過購置價格或鑑價較低者之一定成數（通常可達8成，需符合央行規定）`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb2-003',
    source: '政策性貸款',
    priority: 2,
    topic: '青安貸款利率（一段式機動）',
    keywords: ['青安', '利率', '一段式', '機動利率', '1.775%', '郵政定儲', '+0.555%'],
    content: `【青安貸款利率-一段式機動】：
基準利率：郵政儲金2年期定期儲金機動利率（自113年3月27日起為1.72%）
一段式機動利率：基準利率 + 0.555% = 1.775%（目前）
內政部補貼：0.375%（113.3.27起至115.7.31止），轉貸者不適用補貼
補貼後實際利率：1.775% - 0.375% = 1.4%（享有補貼資格者）
利率每隔一定期間隨郵政定儲利率連動調整`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb2-004',
    source: '政策性貸款',
    priority: 2,
    topic: '青安貸款利率（二段式）',
    keywords: ['青安', '利率', '二段式', '前2年', '第3年', '1.565%', '1.865%', '+0.345%', '+0.645%'],
    content: `【青安貸款利率-二段式】：
前2年：基準利率 + 0.345% = 1.565%（較低，還款壓力較小）
第3年起：基準利率 + 0.645% = 1.865%（略高）
適合：希望前期減輕還款壓力、預計未來收入增加之借款人
注意：二段式利率亦為機動利率，隨郵政定儲利率調整`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb2-005',
    source: '政策性貸款',
    priority: 2,
    topic: '青安貸款利率（混合式固定）',
    keywords: ['青安', '利率', '混合式', '固定利率', '1.745%', '1.845%', '第1年', '第2年', '+0.525%', '+0.625%'],
    content: `【青安貸款利率-混合式固定】：
第1年：基準利率 + 0.525% = 1.745%（固定）
第2年：基準利率 + 0.625% = 1.845%（固定）
第3年起：轉機動利率，基準利率 + 0.645% = 1.865%
適合：希望前期利率固定，預算規劃較確定之借款人
前2年利率固定不隨郵政定儲利率波動`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb2-006',
    source: '政策性貸款',
    priority: 2,
    topic: '國軍輔導理財無擔保貸款計入DBR',
    keywords: ['國軍', '輔導理財', '無擔保', 'DBR', '計入', '倍數'],
    content: `【國軍輔導理財無擔保貸款】：
性質：無擔保政策性貸款，專供現役軍人申請
DBR計算：此貸款屬無擔保債務，需計入借款人DBR（月付款總額/月收入）倍數計算
DBR上限：全體金融機構無擔保債務總餘額不得超過月收入22倍
申請國軍貸款時，須確認與其他無擔保貸款合計不逾DBR上限`,
    loanTypes: ['personal'],
  },
  {
    id: 'kb2-007',
    source: '政策性貸款',
    priority: 2,
    topic: 'DBR計算排除項目（農家樂、加盟主、員工認股）',
    keywords: ['DBR', '排除', '農家樂', '小額貸款', '加盟主', '連鎖企業', '員工認股', '免計入'],
    content: `【DBR豁免項目】以下貸款免計入DBR無擔保債務倍數：
1. 農家樂小額貸款：免計入DBR
2. 連鎖企業加盟主貸款：免計入DBR
3. 企業員工認股貸款（擔保案件）：免計入DBR
前提：擔保案件免計入；無擔保案件仍應計入。
其他無擔保貸款（信貸、信用卡、國軍貸款等）均需計入DBR計算。`,
    loanTypes: ['personal'],
  },
];

// ══════════════════════════════════════════════════════════════
// KB3：一般授信規章（priority = 1，一般權重）
// ══════════════════════════════════════════════════════════════

const KB3_CHUNKS: KbChunk[] = [
  {
    id: 'kb3-001',
    source: '授信規章',
    priority: 1,
    topic: 'DBR規定（22倍上限）',
    keywords: ['DBR', '22倍', '無擔保', '月收入', '月還款', '1/3', '18倍', '未滿20歲'],
    content: `【授信規章 DBR規定】無擔保債務比率（DBR）：
主要規定：全體金融機構無擔保債務總餘額 ÷ 月收入 ≤ 22倍
月還款限制：每月應還款金額 ≤ 月收入 1/3
未成年人特別規定：未滿20歲者，DBR上限為18倍（更嚴格）
計算方式：
  分子 = 所有金融機構無擔保貸款月付款總額（信貸+信用卡最低應繳+其他）
  分母 = 借款人月收入（薪資+固定收入）
超逾22倍者，金融機構不得核准無擔保貸款`,
    loanTypes: ['personal'],
  },
  {
    id: 'kb3-002',
    source: '授信規章',
    priority: 1,
    topic: '房貸寬限期規定',
    keywords: ['寬限期', '最長', '3年', '2年', '1年', '貸款成數', '8成', '第2棟'],
    content: `【授信規章 寬限期規定】房屋貸款寬限期限制：
貸款成數 ≤ 8成者：最長寬限期3年
貸款成數 > 8成者：最長寬限期2年
第2棟（自用）：最長寬限期1年
政策性貸款：從其規定（如青安最長5年）
注意：央行規定名下有房屋之第1戶新申貸不得有寬限期，優先於此規定。
寬限期間：僅繳利息不還本金，到期後開始本息攤還。`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb3-003',
    source: '授信規章',
    priority: 1,
    topic: '房貸貸款期限（年齡+期限≤85歲）',
    keywords: ['貸款期限', '年齡', '85歲', '最長30年', '最長40年', '首購', '修繕', '20年'],
    content: `【授信規章 貸款期限】：
通則：貸款期間 + 申貸時年齡 ≤ 85歲（超逾須有充分理由）
購置住宅：最長30年
首購（名下無自用住宅）：最長40年（同青安貸款規定）
修繕貸款：最長20年
例：45歲申請購屋，最長貸款期限 = 85 - 45 = 40年（首購）或30年（非首購）`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb3-004',
    source: '授信規章',
    priority: 1,
    topic: '負債比分區分級（A區/B區）',
    keywords: ['負債比', 'A區', 'B區', '80%', '70%', '分區', '分級', '個人房屋擔保'],
    content: `【授信規章 分區分級負債比】個人房屋擔保貸款負債比規定：
A區（六都及新竹縣市）：月付款總額（含新申請）/ 月收入 < 80%
B區（其他縣市）：月付款總額（含新申請）/ 月收入 < 70%
計算分子：房貸月付款 + 其他擔保貸款月付款 + 基本生活費18,000元
計算分母：月收入（薪資收入為主）
超逾上限者原則不予核准，除非有充分補強條件`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb3-005',
    source: '授信規章',
    priority: 1,
    topic: '保證人法定保證期間',
    keywords: ['保證人', '法定', '保證期間', '15年', '銀行法', '同意書'],
    content: `【授信規章 保證人規定】：
法定保證期間：依銀行法第12-2條，保證人之保證責任期間為15年
貸款期間超逾15年：須請保證人另行簽立同意書，同意延長保證責任
保證人於15年期滿後，如未簽同意書，保證責任自動解除
實務：貸款30年時，保證人須補簽「貸款第16至30年之保證同意書」`,
  },
  {
    id: 'kb3-006',
    source: '授信規章',
    priority: 1,
    topic: '授信作業流程',
    keywords: ['授信流程', '作業流程', '徵信', '審核', '撥貸', '對保', '簽約', '催收'],
    content: `【授信規章 授信作業流程】標準作業程序（SOP）：
1. 洽談：了解客戶需求，說明產品條件
2. 徵提資料：請客戶備齊所需文件（財力、擔保品等）
3. 徵信調查：信用查詢、財力核實、擔保品查估
4. 分析審核：5P分析（借款人/資金用途/還款來源/擔保品/展望）
5. 通知客戶：核准或婉拒，說明條件
6. 簽約對保：簽訂借款契約、辦理對保
7. 建檔撥貸：建立借款戶資料，撥付貸款
8. 收取本息：依約定期別收取本金與利息
9. 催收：逾期後啟動催收程序`,
  },
  {
    id: 'kb3-007',
    source: '授信規章',
    priority: 1,
    topic: '房貸負債比計算公式（含18,000元）',
    keywords: ['負債比', '計算', '月付款', '18000', '18,000', '月收入', '公式', '房貸審核'],
    content: `【授信規章 房貸負債比計算】：
公式：負債比 = (房貸月付款 + 其他貸款月付款 + 18,000) ÷ 月收入
其中：18,000元 = 最低基本生活費扣除額（固定加計）
範例：
  月收入 = 50,000元
  房貸月付款 = 18,000元，其他貸款月付款 = 5,000元
  負債比 = (18,000 + 5,000 + 18,000) ÷ 50,000 = 82%（A區超逾，B區需強化）
提醒：分母月收入需有充分文件佐證（薪資單、扣繳憑單等）`,
    loanTypes: ['mortgage'],
  },
  {
    id: 'kb3-008',
    source: '授信規章',
    priority: 1,
    topic: '信用評分與5P徵審原則',
    keywords: ['5P', '徵審', '信用評分', '借款人', '資金用途', '還款來源', '擔保品', '展望'],
    content: `【授信規章 5P徵審原則】：
1. People（借款人）：年齡、職業、收入、信用紀錄、還款意願
2. Purpose（資金用途）：貸款目的是否合理、合法
3. Payment（還款來源）：穩定薪資、租金收入、其他可驗證收入
4. Protection（擔保品）：不動產鑑價、產權清晰、第一順位抵押
5. Perspective（展望）：產業前景、借款人職涯規劃、整體財務狀況
各項評分加總決定核准與否及核貸條件（利率、成數、期限）`,
  },
];

// ══════════════════════════════════════════════════════════════
// 合併輸出
// ══════════════════════════════════════════════════════════════

export const ALL_KB_CHUNKS: KbChunk[] = [...KB1_CHUNKS, ...KB2_CHUNKS, ...KB3_CHUNKS];
